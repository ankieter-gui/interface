<nz-layout>

  <nz-sider nzCollapsible nzWidth="200px" nzCollapsible nzBreakpoint="lg" [nzCollapsedWidth]="0">
    <app-global-sidemenu></app-global-sidemenu>
  </nz-sider>


  <nz-layout>
    <nz-header style="justify-content: space-between">
      <img src="assets/logoAnkieter2.png" height="100%" style="margin-left: 1rem;">
      <div style=" width:40vw; margin-left:5vw">

      </div>

    </nz-header>
    <nz-content>
      <section class="header-flex">
      <section class="header-left">
      <header class="header-container">
        <h1 class="breadcrumb-header">Edytor raportu</h1>
      </header>
      <nz-breadcrumb>
        <nz-breadcrumb-item><a [routerLink]="'/'">Ekran główny</a> </nz-breadcrumb-item>
        <nz-breadcrumb-item>Edytor raportu</nz-breadcrumb-item>

      </nz-breadcrumb>
      </section>
        <section class="header-right slide-top-enter-animation" >
          <div style="display: flex;flex-direction: row">
            <nz-tag *ngIf="globalFilter" nzMode="closeable" (nzOnClose)="this.globalFilter=null; refresh(); filterSelector.reset()">{{globalFilter.question}} - {{globalFilter.answer}}</nz-tag>
          <button nz-button nz-dropdown [nzDropdownMenu]="menu4" nzTrigger="click">
            Filtruj ankietę przez odpowiedź
            <i nz-icon nzType="down"></i>
          </button>
          </div>
          <nz-dropdown-menu #menu4="nzDropdownMenu">
           <section nz-menu class="global-filter-container">
              <h3>Filtruj ankietę przez odpowiedź</h3>
             <p>Wybierz pytanie i odpowiedź na nie aby cały raport brał pod uwagę tylko respondentów którzy udzieli na nią takiej odpowiedzi</p>
             <app-filters-selector [namingDictionary]="namingDictionary" #filterSelector (globalFilterChange)="refresh()" [(globalFilter)]="globalFilter" [allQuestions]="surveyQuestions" [reportId]="reportId" [report]="reportDefinition"></app-filters-selector>
           </section>
          </nz-dropdown-menu>
        </section>
      </section>
      <div class="inner-content ">
        <mat-form-field class="title-input">
          <input matInput placeholder="Nazwa raportu" [(ngModel)]="this.reportDefinition.title" (blur)="rename();save()">
        </mat-form-field>
        <div class="report-element" cdkDropList [cdkDropListData]="this.reportDefinition.elements" (cdkDropListDropped)="drop($event)">
          <div class="custom-placeholder" *cdkDragPlaceholder></div>


          <div *ngFor="let element of reportDefinition.elements" cdkDrag class="element-box" style="position:relative;">

          <div [ngSwitch]="element.type" style="position:relative;">
            <mat-icon cdkDragHandle class="drag-handle" [nz-tooltip]="'Przeciągnij aby zmienić kolejność'">open_with</mat-icon>
            <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu" class="more">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="removeElement(element)">
                <mat-icon>delete</mat-icon>
                <span>Usuń</span>
              </button>

            </mat-menu>

            <app-text-editor-view *ngSwitchCase="'text'" [(text)]="element.content.text" (focusEvent)="save()"></app-text-editor-view>
            <app-chart-editor-view *ngSwitchCase="'chart'" [namingDictionary]="namingDictionary" [globalFilter]="globalFilter" [forceUpdate]="forceUpdate" [reportId]="this.reportId" [(chartData)]="element.content" (chartDataChange)="save()" [questions]="surveyQuestions" [surveyId]="this.linkedSurveyId"></app-chart-editor-view>
          </div>

          </div>
        </div>
        <section class="add-more slide-top-enter-animation" (mouseover)="mouseHoveringAddMorePanel=true" (mouseleave)="mouseHoveringAddMorePanel=false">
          <div class="add-more-content add-new"> Dodaj nowy <i nz-icon nzType="plus"></i></div>
          <div class="add-more-content">
            <span [class.shake]="mouseHoveringAddMorePanel" (click)="addNewChartElement()"><span [class.slide-top]="mouseHoveringAddMorePanel"><i  class="recommended" nz-icon nzType="bar-chart" [nz-tooltip]="'Wykres'"></i></span></span>
<!--            <i nz-icon nzType="line-chart" [nz-tooltip]="'Wykres liniowy'"></i>-->
<!--            <i nz-icon nzType="pie-chart" [nz-tooltip]="'Wykres ciasteczkowy (???)'"></i>-->
<!--            <i nz-icon nzType="area-chart" [nz-tooltip]="'Wykres liniowy'"></i>-->
<!--            <i nz-icon nzType="bar-chart" [nz-tooltip]="'Wykres kolumnowy, histogram'"></i>-->
            <i nz-icon nzType="font-size" [nz-tooltip]="'Tekst'" (click)="addNewTextElement()"></i>
          </div>
        </section>

      </div>
    </nz-content>
    <nz-footer></nz-footer>
  </nz-layout>
</nz-layout>
