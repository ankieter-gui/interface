<nz-layout>

  <nz-sider nzCollapsible nzWidth="200px" nzCollapsible nzBreakpoint="lg" [nzCollapsedWidth]="0">
    <app-global-sidemenu></app-global-sidemenu>
  </nz-sider>


  <nz-layout>
    <nz-header style="justify-content: space-between">
      <img src="assets/logoAnkieter2.png" height="100%" style="margin-left: 1rem;">
      <div style=" width:40vw; margin-left:5vw">
        <div>
          <app-user-indicator></app-user-indicator>
        </div>
      </div>

    </nz-header>
    <nz-content>
      <header class="header-container">
        <h1 class="breadcrumb-header">Edytor ankiety</h1>
      </header>
      <nz-breadcrumb>
        <nz-breadcrumb-item><a [routerLink]="'/'">Ekran główny</a> </nz-breadcrumb-item>
        <nz-breadcrumb-item>Edytor ankiety</nz-breadcrumb-item>

      </nz-breadcrumb>
      <button nz-button (click)="dashboardModals.openExportReportDialog(getSurveyAsJson())"></button>
      <div class="inner-content ">
        <mat-form-field class="title-input">
          <input matInput placeholder="Nazwa ankiety" [(ngModel)]="this.surveyDefinition.title" (blur)="rename();save()">
        </mat-form-field>
        <div class="report-element" cdkDropList [cdkDropListData]="this.surveyDefinition.elements"
             (cdkDropListDropped)="drop($event)">
          <div [@fadeInOut] style="background: #ECECEC;padding:30px;" *ngFor="let element of itemsForCurrentPage(); let i=index" cdkDrag  class="element-box" style="position:relative;">
            <nz-card style="max-width: 900px;"  [nzTitle]="getComponentFromType(element['questionType']).friendlyName" [nzExtra]="extraTemplate">
              <div style="position: relative; padding-left:2em;padding-right:2em;padding-top:0.5em">

                <app-survey-element-host [componentConfig]="getComponentFromType(element['questionType'])" [element]="element" (saveEmitter)="save()"></app-survey-element-host>

              </div>
            </nz-card>
          </div>
          <ng-template #extraTemplate>
           <div>
             <button mat-icon-button cdkDragHandle [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
               <mat-icon>open_with</mat-icon>
             </button>

             <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
               <mat-icon>more_vert</mat-icon>
             </button>
             <mat-menu #menu="matMenu">
               <button mat-menu-item (click)="removeElement(element)">
                 <mat-icon>delete</mat-icon>
                 <span>Usuń</span>
               </button>
             </mat-menu>
           </div>
          </ng-template>



        </div>
        <section class="add-more slide-top-enter-animation" (mouseover)="mouseHoveringAddMorePanel=true" (mouseleave)="mouseHoveringAddMorePanel=false">
          <div class="add-more-content add-new"> Dodaj pytanie <i nz-icon nzType="plus"></i></div>
          <div style="display: flex; color:rgba(0,0,0,0.6)">
            <div *ngFor="let x of addButtonsList" style="margin: 1.2em; cursor: pointer; display: flex;flex-direction: row"  class="hover-add">
              <div>{{x.friendlyName}}<div>
              <i style="display: block;font-size: 2em" nz-icon [nzType]="x.icon" (click)="x.onAddEvent()()" ></i>
            </div>

          </div>
            </div>
          </div>
        </section>

      </div>
    </nz-content>
    <nz-footer></nz-footer>
  </nz-layout>
</nz-layout>
